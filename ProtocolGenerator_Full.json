{"name":"Protocol Generator with File Input (AI + SMART + PDF)","nodes":[{"parameters":{"path":"create-protocol","options":{}},"id":"webhook1","name":"Webhook Trigger","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[200,300]},{"parameters":{"url":"={{$json[\"file_url\"]}}","options":{}},"id":"httpDownload1","name":"Download File","type":"n8n-nodes-base.httpRequest","typeVersion":2,"position":[400,300]},{"parameters":{"functionCode":"\nconst fileName = $json.headers['content-disposition']?.match(/filename=\"?(.+)\"?/);\nconst ext = fileName?.[1]?.split('.').pop()?.toLowerCase();\nreturn [{ json: { fileType: ext || 'unknown' } }];\n"},"id":"functionDetectType","name":"Detect File Type","type":"n8n-nodes-base.function","typeVersion":1,"position":[600,300]},{"parameters":{"conditions":{"string":[{"value1":"={{$json[\"fileType\"]}}","value2":"mp3"}]}},"id":"ifIsAudio","name":"IF .mp3?","type":"n8n-nodes-base.if","typeVersion":1,"position":[800,300]},{"parameters":{"url":"https://api.openai.com/v1/audio/transcriptions","method":"POST","authentication":"predefinedCredentialType","sendBinaryData":true,"binaryPropertyName":"data","options":{"headers":{"Content-Type":"multipart/form-data"}},"bodyContentType":"multipart-form-data","jsonParameters":false},"id":"whisper","name":"Transcribe MP3 (Whisper)","type":"n8n-nodes-base.httpRequest","typeVersion":2,"position":[1000,100]},{"parameters":{"filePath":"={{$binary.data.fileName}}"},"id":"docxParser","name":"Parse DOCX (External Parser)","type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[1000,500]},{"parameters":{"functionCode":"\nreturn [{\n  json: {\n    text: $json.text || $json.choices?.[0]?.message?.content || 'No content'\n  }\n}];\n"},"id":"prepText","name":"Extract Text","type":"n8n-nodes-base.function","typeVersion":1,"position":[1200,300]},{"parameters":{"url":"https://api.openai.com/v1/chat/completions","method":"POST","authentication":"predefinedCredentialType","sendBody":true,"jsonParameters":true,"bodyParametersJson":"{\"model\": \"gpt-4o\", \"messages\": [{\"role\": \"system\", \"content\": \"\\u0422\\u044b \\u043f\\u043e\\u043c\\u043e\\u0449\\u043d\\u0438\\u043a, \\u0441\\u043e\\u0437\\u0434\\u0430\\u044e\\u0449\\u0438\\u0439 \\u043f\\u0440\\u043e\\u0442\\u043e\\u043a\\u043e\\u043b \\u0441\\u043e\\u0432\\u0435\\u0449\\u0430\\u043d\\u0438\\u044f. \\u0421\\u0442\\u0440\\u0443\\u043a\\u0442\\u0443\\u0440\\u0438\\u0440\\u0443\\u0439 \\u0437\\u0430\\u0434\\u0430\\u0447\\u0438 \\u043f\\u043e SMART, \\u0432\\u044b\\u0434\\u0435\\u043b\\u0438 \\u043a\\u043b\\u044e\\u0447\\u0435\\u0432\\u044b\\u0435 \\u044d\\u043b\\u0435\\u043c\\u0435\\u043d\\u0442\\u044b.\"}, {\"role\": \"user\", \"content\": \"{{ $json['text'] }}\"}]}"},"id":"openai1","name":"Analyze Text with OpenAI","type":"n8n-nodes-base.httpRequest","typeVersion":2,"position":[1400,300],"credentials":{"httpBasicAuth":{"id":"openai-credentials-id"}}},{"parameters":{"functionCode":"\nreturn [{\n  json: {\n    summary: $json.choices[0].message.content,\n    timestamp: new Date().toISOString()\n  }\n}];\n"},"id":"function1","name":"Extract Summary","type":"n8n-nodes-base.function","typeVersion":1,"position":[1600,300]},{"parameters":{"documentId":"your-doc-id","mode":"write","valueInputMode":"RAW","dataProperty":"summary"},"id":"gdocWrite","name":"Write to Google Doc","type":"n8n-nodes-base.googleDocs","typeVersion":1,"position":[1800,300],"credentials":{"googleDocsOAuth2Api":{"id":"google-docs-creds-id"}}},{"parameters":{"documentId":"your-doc-id","exportFormat":"pdf"},"id":"exportPDF","name":"Export to PDF","type":"n8n-nodes-base.googleDocs","typeVersion":1,"position":[2000,300],"credentials":{"googleDocsOAuth2Api":{"id":"google-docs-creds-id"}}},{"parameters":{"chatId":"={{$json[\"user_id\"]}}","binaryPropertyName":"data","options":{}},"id":"sendFile","name":"Send File to Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[2200,300],"credentials":{"telegramApi":{"id":"telegram-credentials-id"}}}],"connections":{},"active":false,"settings":{},"versionId":"2025-08-04T05:17:34.804635"}